webpackJsonp([1],{"+/MR":function(e,t){},"+kvY":function(e,t){},GCE7:function(e,t){},IFmZ:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("rVsN"),n=r.n(a),s=r("xd7I"),i={props:{name:{type:String,default:"changePasswordDialog"},canShow:{type:Boolean,default:!1},dialogFormVisible:{type:Boolean,default:!1}},data:function(){var e=this;return{account:{old_Passwort:"",new_Passwort:"",new_Passwort2:""},errorMsg:"",rules:{old_Passwort:[{required:!0,message:"请输入原密码",trigger:"blur"},{max:50,message:"输入长度不超过50字符",trigger:"blur"},{min:5,message:"输入长度不能短于5字符",trigger:"blur"}],new_Passwort:[{required:!0,message:"请输入新密码",trigger:"blur"},{max:50,message:"密码长度不超过50字符",trigger:"blur"},{min:5,message:"密码长度不能短于5字符",trigger:"blur"}],new_Passwort2:[{required:!0,validator:function(t,r,a){r?(r!==e.account.new_Passwort&&a(new Error("两次密码不一致")),a()):a(new Error("请确认密码"))},trigger:"blur"}]}}},methods:{confirmChange:function(){var e=this;this.$refs.account.validate(function(t){if(t){e.errorMsg="";var r=new URLSearchParams;r.append("oldpwd",e.account.old_Passwort),r.append("newpwd",e.account.new_Passwort),e.$axios.post("/accounts/setpwd",r).then(function(t){e.$message.success("修改成功,请重新登录"),e.getVisibility=!1,e.$store.commit("logout"),e.$router.push("/")}).catch(function(t){e.$message.error("密码错误，请重试"),e.errorMsg="请重新输入密码",e.account.old_Passwort=""})}})},cancelChange:function(){this.getVisibility=!1}},watch:{dialogFormVisible:function(){}},computed:{getVisibility:{set:function(e){this.$emit("set-dialog-visibility",e),this.$refs.account.resetFields()},get:function(){return this.dialogFormVisible}}}},o={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"修改密码",visible:e.getVisibility},on:{"update:visible":function(t){e.getVisibility=t}}},[r("el-form",{ref:"account",staticClass:"demo-ruleForm",attrs:{model:e.account,rules:e.rules,"label-position":"left","label-width":"0px"}},[r("el-form-item",{attrs:{prop:"old_Passwort",error:e.errorMsg}},[r("div",{attrs:{align:"left"}},[e._v("原密码")]),e._v(" "),r("el-input",{attrs:{type:"password",placeholder:"请输入原密码"},model:{value:e.account.old_Passwort,callback:function(t){e.$set(e.account,"old_Passwort",t)},expression:"account.old_Passwort"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"new_Passwort"}},[r("div",{attrs:{align:"left"}},[e._v("新密码")]),e._v(" "),r("el-input",{attrs:{type:"password",placeholder:"请输入新密码"},model:{value:e.account.new_Passwort,callback:function(t){e.$set(e.account,"new_Passwort",t)},expression:"account.new_Passwort"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"new_Passwort2"}},[r("div",{attrs:{align:"left"}},[e._v("确认新密码")]),e._v(" "),r("el-input",{attrs:{type:"password",placeholder:"请确认新密码"},model:{value:e.account.new_Passwort2,callback:function(t){e.$set(e.account,"new_Passwort2",t)},expression:"account.new_Passwort2"}})],1),e._v(" "),r("el-form-item",{staticStyle:{width:"100%","text-align":"center"}},[r("el-button",{staticStyle:{width:"45%"},attrs:{type:"primary",round:""},on:{click:e.confirmChange}},[e._v("确认修改")]),e._v(" "),r("el-button",{staticStyle:{width:"45%"},attrs:{round:""},on:{click:e.cancelChange}},[e._v("取消修改")])],1)],1)],1)},staticRenderFns:[]};var l=r("C7Lr")(i,o,!1,function(e){r("Ru3H")},"data-v-9c68dec4",null).exports,c={props:{name:{type:String,default:"changePhoneDialog"},canShow:{type:Boolean,default:!1},dialogFormVisible:{type:Boolean,default:!1}},data:function(){var e=this;return{account:{phone:"",phone2:""},rules:{phone:[{validator:function(e,t,r){t?(/^[0-9]{11}$/.test(t)||r(new Error("请输入合法的电话号")),r()):r(new Error("请输入新的联系电话"))},trigger:"blur"}],phone2:[{validator:function(t,r,a){r?(r!==e.account.phone&&a(new Error("两次输入不一致")),a()):a(new Error("请确认新的联系电话"))},trigger:"blur"}]}}},methods:{confirmChange:function(){var e=this;this.$refs.account.validate(function(t){if(t){var r=new URLSearchParams;r.append("phone",e.account.phone),e.$axios.post("/accounts/setinfo",r).then(function(t){e.$message.success("修改成功!"),e.getVisibility=!1}).catch(function(t){e.$message.error("修改失败，请重试")})}})},cancelChange:function(){this.getVisibility=!1}},watch:{dialogFormVisible:function(){}},computed:{getVisibility:{set:function(e){this.$emit("set-dialog-visibility",e),this.$refs.account.resetFields()},get:function(){return this.dialogFormVisible}}}},u={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-dialog",{attrs:{title:"修改电话号码",visible:e.getVisibility},on:{"update:visible":function(t){e.getVisibility=t}}},[r("el-form",{ref:"account",staticClass:"demo-ruleForm",attrs:{model:e.account,rules:e.rules,"label-position":"left","label-width":"0px"}},[r("el-form-item",{attrs:{prop:"phone"}},[r("div",{attrs:{align:"left"}},[e._v("新联系方式")]),e._v(" "),r("el-input",{attrs:{type:"text",placeholder:"请输入新的电话号码"},model:{value:e.account.phone,callback:function(t){e.$set(e.account,"phone",t)},expression:"account.phone"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"phone2"}},[r("div",{attrs:{align:"left"}},[e._v("确认新联系方式")]),e._v(" "),r("el-input",{attrs:{type:"text",placeholder:"请确认新的电话号码"},model:{value:e.account.phone2,callback:function(t){e.$set(e.account,"phone2",t)},expression:"account.phone2"}})],1),e._v(" "),r("el-form-item",{staticStyle:{width:"100%","text-align":"center"}},[r("el-button",{staticStyle:{width:"45%"},attrs:{type:"primary",round:""},on:{click:e.confirmChange}},[e._v("确认修改")]),e._v(" "),r("el-button",{staticStyle:{width:"45%"},attrs:{round:""},on:{click:e.cancelChange}},[e._v("取消修改")])],1)],1)],1)},staticRenderFns:[]};var d=r("C7Lr")(c,u,!1,function(e){r("kfZH")},"data-v-74706b8f",null).exports,m={name:"BreadCrumb",computed:{routeList:function(){return this.$store.state.routeList}},watch:{$route:function(e,t){var r=[];if(console.log(e.name),"LogIn"===e.name||"Register"===e.name);else if("SingleReserve"===e.name||"ReservationRecord"===e.name||"ReserveSuccess"===e.name||"ReservePending"===e.name)r.push({path:e.path,query:e.query,title:e.meta.title});else{var a=(r=this.$store.state.routeList).findIndex(function(t){return t.path===e.path});-1!==a?r.splice(a+1,r.length-a-1):r.push({path:e.path,query:e.query,title:e.meta.title})}this.$store.commit("setRouteList",r)}}},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"breadcrumb"},[0!==e.routeList.length?r("i",{staticClass:"el-icon-caret-right",staticStyle:{display:"inline-block"}}):e._e(),e._v(" "),r("el-breadcrumb",{staticStyle:{display:"inline-block","margin-left":"2px"},attrs:{separator:"/"}},e._l(e.routeList,function(t){return r("el-breadcrumb-item",{key:t.path},[r("router-link",{attrs:{to:{path:t.path,query:t.query}}},[e._v(e._s(t.title))])],1)}),1)],1)},staticRenderFns:[]};var f={name:"App",components:{breadcrumb:r("C7Lr")(m,p,!1,function(e){r("+kvY")},"data-v-a802e6d4",null).exports,pswdialog:l,phndialog:d},data:function(){return{username:"",showPwdDlg:!1,showPhnDlg:!1}},created:function(){"/"!==this.$route.path&&"register"!==this.$route.path||this.$store.commit("logout")},destroyed:function(){this.$store.commit("logout")},methods:{handleCommand:function(e){var t=this;"logout"===e?this.$axios.post("accounts/logout").then(function(e){t.$store.commit("logout"),t.$router.push("/")}):"changePassword"===e?this.showPwdDlg=!0:"changePhone"===e&&(this.showPhnDlg=!0)},goSingleReserve:function(){this.$router.push("/single_reserve")},goReserveRecord:function(){this.$router.push("/reservation_record")},closePwdDlg:function(e){this.showPwdDlg=e},closePhnDlg:function(e){this.showPhnDlg=e}}},g={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("el-row",{staticClass:"topbar",attrs:{type:"flex",justify:"space-between"}},[r("el-col",{staticClass:"topbar-tittle",attrs:{span:10}},[r("div",{attrs:{align:"left"}},[e._v("3D打印预约系统")])]),e._v(" "),e.$route.meta.hasNavbar?r("el-col",{attrs:{span:6,align:"left"}},[r("div",{staticStyle:{display:"inline",color:"gray"}},[e._v("|")]),e._v(" "),r("el-button",{staticClass:"navbar-item",attrs:{type:"text"},on:{click:e.goSingleReserve}},[e._v("个人预约")]),e._v(" "),r("div",{staticStyle:{display:"inline",color:"gray"}},[e._v("|")]),e._v(" "),r("el-button",{staticClass:"navbar-item",attrs:{type:"text"},on:{click:e.goReserveRecord}},[e._v("预约记录")]),e._v(" "),r("div",{staticStyle:{display:"inline",color:"gray"}},[e._v("|")])],1):e._e(),e._v(" "),e.$route.meta.hasInfo?r("el-col",{attrs:{span:2}},[r("el-dropdown",{attrs:{"hide-on-click":!1},on:{command:e.handleCommand},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}},[r("span",{staticClass:"el-dropdown-link",staticStyle:{cursor:"pointer"}},[r("i",{staticClass:"el-icon-user-solid"}),e._v("\n          "+e._s(e.$store.state.username)+"\n        ")]),e._v(" "),r("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[r("el-dropdown-item",{attrs:{command:"logout"}},[e._v("退出")]),e._v(" "),r("el-dropdown-item",{attrs:{command:"changePassword"}},[e._v("修改账号密码")]),e._v(" "),r("el-dropdown-item",{attrs:{command:"changePhone"}},[e._v("修改联系电话")])],1)],1)],1):e._e()],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:24}},[r("breadcrumb")],1)],1),e._v(" "),r("pswdialog",{attrs:{dialogFormVisible:e.showPwdDlg},on:{"set-dialog-visibility":e.closePwdDlg}}),e._v(" "),r("phndialog",{attrs:{dialogFormVisible:e.showPhnDlg},on:{"set-dialog-visibility":e.closePhnDlg}}),e._v(" "),r("router-view")],1)},staticRenderFns:[]};var v=r("C7Lr")(f,g,!1,function(e){r("kce6")},null,null).exports,h=r("e1F6"),_={name:"LogIn",data:function(){return{loginInfo:{username:"",Passwort:""},rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"},{max:30,message:"长度不超过30字符",trigger:"blur"}],Passwort:[{required:!0,message:"请输入密码",trigger:"blur"},{max:50,message:"长度不超过50字符",trigger:"blur"}]},loginErrUsrnm:"",loginErrPswd:""}},methods:{login:function(){var e=this;this.$refs.usernameLogin.validate(function(t){if(t){e.loginErr="";var r=new URLSearchParams;r.append("username",e.loginInfo.username),r.append("password",e.loginInfo.Passwort),console.log(r),e.$axios.post("/accounts/login",r).then(function(t){var r={username:e.loginInfo.username,isAdmin:t.data.admin,maxRsv:t.data.max_reserve};e.$store.commit("login",r),r.isAdmin?e.$router.push("/admin_signin"):e.$router.push("/single_reserve"),console.log(r)}).catch(function(t){e.$message.error("密码错误或账户不存在")})}})},goRegister:function(){this.$router.push("/register")}}},b={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",{staticClass:"login-container"},[r("el-header",{staticClass:"login-header"},[r("div",{staticStyle:{margin:"auto"}},[e._v("用户登录")])]),e._v(" "),r("el-main",{staticClass:"login-main"},[r("el-form",{ref:"usernameLogin",attrs:{model:e.loginInfo,rules:e.rules,"label-suffix":"left","label-width":"0px"}},[r("el-form-item",{attrs:{prop:"username",error:e.loginErrUsrnm}},[r("div",{staticClass:"login-main",attrs:{align:"left"}},[e._v("账号")]),e._v(" "),r("el-input",{attrs:{type:"text",placeholder:"请输入账号","auto-complete":"off","prefix-icon":"el-icon-user-solid"},model:{value:e.loginInfo.username,callback:function(t){e.$set(e.loginInfo,"username",t)},expression:"loginInfo.username"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"Passwort",error:e.loginErrPswd}},[r("div",{staticClass:"login-main",attrs:{align:"left"}},[e._v("密码")]),e._v(" "),r("el-input",{attrs:{type:"password",placeholder:"请输入密码","auto-complete":"off","prefix-icon":"el-icon-lock"},model:{value:e.loginInfo.Passwort,callback:function(t){e.$set(e.loginInfo,"Passwort",t)},expression:"loginInfo.Passwort"}})],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-button",{staticStyle:{width:"60%"},attrs:{type:"primary"},on:{click:e.login}},[e._v("登录")])],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-button",{staticStyle:{width:"60%"},on:{click:e.goRegister}},[e._v("注册")])],1)],1)],1)],1)},staticRenderFns:[]};var w=r("C7Lr")(_,b,!1,function(e){r("vMds")},"data-v-70edfd23",null).exports,y={name:"Register",data:function(){var e=this;return{registerInfo:{username:"",Passwort:"",Passwort2:"",email:"",phone:""},registerErrUsrnm:"",registerErrPswd:"",registerErrPswd2:"",registerErrEml:"",registerErrPhn:"",rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{max:30,message:"用户名长度不超过30字符",trigger:"blur"},{min:5,message:"用户名长度不能短于5字符",trigger:"blur"}],Passwort:[{validator:function(e,t,r){t?r():r(new Error("请输入密码"))},trigger:"blur"},{max:50,message:"密码长度不超过50字符",trigger:"blur"},{min:6,message:"密码长度不能短于6字符",trigger:"blur"}],Passwort2:[{validator:function(t,r,a){r?(r!==e.registerInfo.Passwort&&a(new Error("密码不一致")),a()):a(new Error("请确认密码"))},trigger:"blur"}],email:[{validator:function(e,t,r){t?(/^([a-zA-Z0-9]+[-_\.]?)+@([a-zA-Z0-9]+\.)+[a-z]+$/.test(t)||r(new Error("邮箱格式错误")),r()):r(new Error("请输入邮箱"))},trigger:"blur"},{max:50,message:"邮箱长度不超过50字符",trigger:"blur"}],phone:[{validator:function(e,t,r){t?(/^[0-9]{11}$/.test(t)||r(new Error("请输入格式正确的联系电话")),r()):r(new Error("请输入你的联系电话"))},trigger:"blur"}]}}},methods:{register:function(){var e=this;this.$refs.usernameRegister.validate(function(t){if(t){e.registerErrEml="",e.registerErrUsrnm="",e.registerErrPswd="",e.registerErrPswd2="",e.registerErrPhn="";var r=new URLSearchParams;r.append("username",e.registerInfo.username),r.append("password",e.registerInfo.Passwort),r.append("email",e.registerInfo.email),r.append("phone",e.registerInfo.phone),e.$axios.post("/accounts/register",r).then(function(t){e.$alert("注册成功，请验证邮箱后登录","成功",{confirmButtonText:"确定",callback:function(t){e.$router.push("/")}})}).catch(function(t){e.$message.error("注册失败，请检查表单"),1===t.data.result?(console.log("reg fail1"),e.registerErrEml="注册失败，请使用清华邮箱"):2===t.data.result&&(console.log("reg fail2"),e.registerErrUsrnm="注册失败，用户名已被占用")})}})},goLogin:function(){this.$router.go(-1)}}},x={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-container",{staticClass:"register-container"},[r("el-header",{staticClass:"register-header"},[r("div",{staticStyle:{margin:"auto"}},[e._v("注册")])]),e._v(" "),r("el-main",{staticClass:"register-main"},[r("el-form",{ref:"usernameRegister",attrs:{model:e.registerInfo,rules:e.rules,"label-suffix":"left","label-width":"0px"}},[r("el-row",[r("el-col",{attrs:{span:5}},[r("div",{staticClass:"register-title",attrs:{align:"right"}},[e._v("用户名：")])]),e._v(" "),r("el-col",{attrs:{span:19}},[r("el-form-item",{attrs:{prop:"username",error:e.registerErrUsrnm}},[r("el-input",{attrs:{type:"text",placeholder:"请输入账号","auto-complete":"off","prefix-icon":"el-icon-user-solid"},model:{value:e.registerInfo.username,callback:function(t){e.$set(e.registerInfo,"username",t)},expression:"registerInfo.username"}}),e._v(" "),r("div",{staticClass:"register-tip",attrs:{align:"left"}},[e._v("5到30个字符，不能包括特殊字符")])],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:5}},[r("div",{staticClass:"register-title",attrs:{align:"right"}},[e._v("密码：")])]),e._v(" "),r("el-col",{attrs:{span:19}},[r("el-form-item",{attrs:{prop:"Passwort",error:e.registerErrPswd}},[r("el-input",{attrs:{type:"password",placeholder:"请输入密码","auto-complete":"off","prefix-icon":"el-icon-lock"},model:{value:e.registerInfo.Passwort,callback:function(t){e.$set(e.registerInfo,"Passwort",t)},expression:"registerInfo.Passwort"}}),e._v(" "),r("div",{staticClass:"register-tip",attrs:{align:"left"}},[e._v("6到50个字符，不能包括特殊字符")])],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:5}},[r("div",{staticClass:"register-title",attrs:{align:"right"}},[e._v("确认密码：")])]),e._v(" "),r("el-col",{attrs:{span:19}},[r("el-form-item",{attrs:{prop:"Passwort2",error:e.registerErrPswd2}},[r("el-input",{attrs:{type:"password",placeholder:"请再次输入密码","auto-complete":"off","prefix-icon":"el-icon-lock"},model:{value:e.registerInfo.Passwort2,callback:function(t){e.$set(e.registerInfo,"Passwort2",t)},expression:"registerInfo.Passwort2"}}),e._v(" "),r("div",{staticClass:"register-tip",attrs:{align:"left"}},[e._v("再次输入在之前输入的密码")])],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:5}},[r("div",{staticClass:"register-title",attrs:{align:"right"}},[e._v("邮箱：")])]),e._v(" "),r("el-col",{attrs:{span:19}},[r("el-form-item",{attrs:{prop:"email",error:e.registerErrEml}},[r("el-input",{attrs:{type:"text",placeholder:"请输入清华大学邮箱","auto-complete":"off","prefix-icon":"el-icon-message"},model:{value:e.registerInfo.email,callback:function(t){e.$set(e.registerInfo,"email",t)},expression:"registerInfo.email"}}),e._v(" "),r("div",{staticClass:"register-tip",attrs:{align:"left"}},[e._v("请输入本人的清华大学邮箱")])],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:5}},[r("div",{staticClass:"register-title",attrs:{align:"right"}},[e._v("联系电话：")])]),e._v(" "),r("el-col",{attrs:{span:19}},[r("el-form-item",{attrs:{prop:"phone",error:e.registerErrPhn}},[r("el-input",{attrs:{type:"text",placeholder:"请输入可以用于通知预约变更的联系电话","auto-complete":"off","prefix-icon":"el-icon-phone-outline"},model:{value:e.registerInfo.phone,callback:function(t){e.$set(e.registerInfo,"phone",t)},expression:"registerInfo.phone"}}),e._v(" "),r("div",{staticClass:"register-tip",attrs:{align:"left"}},[e._v("请输入本人的联系电话")])],1)],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:12}},[r("el-button",{staticStyle:{width:"60%"},attrs:{type:"primary"},on:{click:e.register}},[e._v("注册账号")])],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-button",{staticStyle:{width:"60%"},on:{click:e.goLogin}},[e._v("返回")])],1)],1)],1)],1)},staticRenderFns:[]};var P=r("C7Lr")(y,x,!1,function(e){r("jCJR")},"data-v-2ed10061",null).exports,$={name:"SingleReserve",methods:{goSpecial:function(){console.log("goSpecial"),this.$router.push("/special_reserve_form")},goForm:function(){var e=this;this.$axios.get("/records/queryreserve").then(function(t){t.data.count>0?e.$message.error("您还有未完成的预约，请完成预约后再进行另外的预约"):e.$router.push("/single_reserve_form")}).catch(function(t){e.$message.error("可用记录查询失败，请重试"),console.log(t)})}}},R={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-card",[r("el-row",{staticStyle:{height:"400px"}},[r("el-col",{staticClass:"left-col",attrs:{span:12}},[r("div",{staticClass:"button-box"},[r("el-button",{staticClass:"reserve-bottun",attrs:{type:"primary"},on:{click:e.goForm}},[e._v("填写普通申请表单")])],1),e._v(" "),r("div",{staticClass:"hint-box"},[e._v("\n        *普通预约可以预约工作日上午或下午的3D打印机\n      ")])]),e._v(" "),r("el-col",{attrs:{span:12}},[r("div",{staticClass:"button-box"},[r("el-button",{staticClass:"reserve-bottun",on:{click:e.goSpecial}},[e._v("特殊申请通道")])],1),e._v(" "),r("div",{staticClass:"hint-box"},[e._v("\n        *如果需要预约其他时段，请点击此处\n      ")])])],1)],1)},staticRenderFns:[]};var I=r("C7Lr")($,R,!1,function(e){r("IFmZ"),r("GCE7")},"data-v-32d910e2",null).exports,C={name:"ReservationRecord",data:function(){return{rsvRecords:[],rsvTotal:0,usgRecords:[],usgTotal:0,brcRecords:[],brcTotal:0,rsvCurrentPage:1,recordPerPage:10,usgCurrentPage:1,brcCurrentPage:1}},created:function(){this.queryReserveInfo()},methods:{switchTab:function(e){switch(e.index){case"0":this.queryReserveInfo();break;case"1":this.queryUsageInfo();break;case"2":this.queryBrcInfo()}},handleRsvCurrentChange:function(e){this.rsvCurrentPage=e},handleUsgCurrentChange:function(e){this.usgCurrentPage=e},handleBrcCurrentChange:function(e){this.brcCurrentPage=e},queryReserveInfo:function(){var e=this;this.$axios.get("/records/queryreserve",{params:{page:this.rsvCurrentPage}}).then(function(t){console.log(t),e.rsvTotal=t.data.count,e.rsvRecords=t.data.results}).catch(function(t){e.$message.error("查询失败，请重试"),console.log(t)})},queryUsageInfo:function(){var e=this;this.$axios.get("/records/queryuse",{params:{page:this.usgCurrentPage}}).then(function(t){console.log(t),e.usgTotal=t.data.count,e.usgRecords=t.data.results}).catch(function(t){e.$message.error("查询失败，请重试"),console.log(t)})},queryBrcInfo:function(){var e=this;this.$axios.get("/records/querybreach",{params:{page:this.brcCurrentPage}}).then(function(t){console.log(t),e.brcTotal=t.data.count,e.brcRecords=t.data.results}).catch(function(t){e.$message.error("查询失败，请重试"),console.log(t)})},removeRsv:function(e){var t=this;this.$confirm("是否确定取消该次预约?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(function(){t.$axios.post("/reserve/cancel",{id:e}).then(function(e){t.$message.success("取消成功!"),t.queryReserveInfo()}).catch(function(e){t.$message.error("取消失败，请重试")})}).catch(function(){})}}},k={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-tabs",{staticStyle:{"min-height":"480px"},attrs:{type:"border-card","tab-position":"left",stretch:!0},on:{"tab-click":e.switchTab}},[r("el-tab-pane",{attrs:{label:"预约情况"}},[r("el-table",{ref:"revRecords",attrs:{data:e.rsvRecords}},[r("el-table-column",{attrs:{label:"编号","min-width":"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.id))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"预约时间","min-width":"260",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.submit_time))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"使用时间","min-width":"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["AM"===t.row.time?r("div",[e._v(e._s(t.row.date+" ")+"上午")]):e._e(),e._v(" "),"PM"===t.row.time?r("div",[e._v(e._s(t.row.date+" ")+"下午")]):e._e(),e._v(" "),"OT"===t.row.time?r("div",[e._v(e._s(t.row.date+" ")+e._s(t.row.special_time))]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"使用人",align:"center"}},[r("el-table-column",{attrs:{label:"姓名","min-width":"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.operator.name))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"ID","min-width":"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.operator.id))])]}}])})],1),e._v(" "),r("el-table-column",{attrs:{label:"状态","min-width":"70",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.checked?r("div",{staticStyle:{color:"green"}},[e._v("已通过")]):e._e(),e._v(" "),t.row.checked?e._e():r("div",{staticStyle:{color:"gray"}},[e._v("审核中")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"备注","min-width":"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-popover",{attrs:{placement:"right",trigger:"click",width:"120"}},[r("div",[e._v(e._s(t.row.note))]),e._v(" "),r("el-button",{attrs:{slot:"reference",size:"small",type:"primary",plain:!0,disabled:!t.row.note},slot:"reference"},[e._v("查看")])],1)]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"small",type:"danger",plain:!0},on:{click:function(r){return e.removeRsv(t.row.id)}}},[e._v("取消")])]}}])})],1),e._v(" "),r("el-pagination",{attrs:{total:e.rsvTotal,"current-page":e.rsvCurrentPage,"page-size":e.recordPerPage,"pager-count":11,layout:"prev, pager, next, jumper, ->, total"},on:{"current-change":e.handleRsvCurrentChange}})],1),e._v(" "),r("el-tab-pane",{attrs:{label:"使用记录"}},[r("el-table",{ref:"usgRecords",attrs:{data:e.usgRecords}},[r("el-table-column",{attrs:{label:"编号","min-width":"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.id))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"签到时间","min-width":"160",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.start_time))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"签退时间","min-width":"160",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.end_time))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"使用人",align:"center"}},[r("el-table-column",{attrs:{label:"姓名","min-width":"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.operator.name))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"ID","min-width":"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.operator.id))])]}}])})],1),e._v(" "),r("el-table-column",{attrs:{label:"备注","min-width":"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-popover",{attrs:{placement:"right",trigger:"click",width:"120"}},[r("div",[e._v(e._s(t.row.note))]),e._v(" "),r("el-button",{attrs:{slot:"reference",size:"small",type:"primary",plain:!0,disabled:!t.row.note},slot:"reference"},[e._v("查看")])],1)]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"打印机",align:"center","min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v("编号:"+e._s(t.row.machine.id))])]}}])})],1),e._v(" "),r("el-pagination",{attrs:{total:e.usgTotal,"current-page":e.usgCurrentPage,"page-size":e.recordPerPage,"pager-count":11,layout:"prev, pager, next, jumper, ->, total"},on:{"current-change":e.handleUsgCurrentChange}})],1),e._v(" "),r("el-tab-pane",{ref:"brc",attrs:{label:"违约记录"}},[r("el-table",{ref:"brcRecords",attrs:{data:e.brcRecords}},[r("el-table-column",{attrs:{label:"编号","min-width":"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.id))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"预约时间","min-width":"160",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.submit_time))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"使用时间","min-width":"160",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["AM"===t.row.time?r("div",[e._v(e._s(t.row.date+" ")+"上午")]):e._e(),e._v(" "),"PM"===t.row.time?r("div",[e._v(e._s(t.row.date+" ")+"下午")]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"使用人",align:"center"}},[r("el-table-column",{attrs:{label:"姓名","min-width":"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.operator.name))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"ID","min-width":"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.operator.id))])]}}])})],1),e._v(" "),r("el-table-column",{attrs:{label:"备注","min-width":"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-popover",{attrs:{placement:"right",trigger:"click",width:"120"}},[r("div",[e._v(e._s(t.row.note))]),e._v(" "),r("el-button",{attrs:{slot:"reference",size:"small",type:"primary",plain:!0,disabled:!t.row.note},slot:"reference"},[e._v("查看")])],1)]}}])})],1),e._v(" "),r("el-pagination",{attrs:{total:e.brcTotal,"current-page":e.brcCurrentPage,"page-size":e.recordPerPage,"pager-count":11,layout:"prev, pager, next, jumper, ->, total"},on:{"current-change":e.handleBrcCurrentChange}})],1)],1)],1)},staticRenderFns:[]};var S=r("C7Lr")(C,k,!1,function(e){r("jVDp")},"data-v-fbc78d36",null).exports,T=r("aA9S"),M=r.n(T),E={name:"ReserveForm",created:function(){this.updateDateInfo()},data:function(){var e=this;return{leaderInfo:[{name:"",id:""}],reason:{text:""},reasonRule:{text:[{required:!0,message:"请输入预约事由",trigger:"blur"}]},leaderRules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],id:[{required:!0,message:"请输入证件号",trigger:"blur"},{validator:function(e,t,r){t?(/^20[0-9]{8}$/.test(t)||r(new Error("证件号格式错误")),r()):r(new Error("请输入证件号"))},trigger:"blur"}]},dateTimeRules:{date:[{required:!0,message:"请选择日期",trigger:"blur"}],AMPM:[{required:!0,message:"请选择时段",trigger:"blur"},{validator:function(t,r,a){r?("上午"===r&&e.AMRemain<e.leaderInfo.length&&a(new Error("该时段无法预约"+e.leaderInfo.length+"台机器, 请减少数量或重新选择时段")),"下午"===r&&e.PMRemain<e.leaderInfo.length&&a(new Error("该时段无法预约"+e.leaderInfo.length+"台机器, 请减少数量或重新选择时段")),a()):a(new Error("请选择时段"))},trigger:"blur"}]},dateTime:{date:"",AMPM:""},dateUnvalid:[],dateInfo:[],AMRemain:8,PMRemain:8,dateOptions:{disabledDate:function(e){var t=e.getDay();return e.getTime()<=Date.now()||6===t||0===t}}}},methods:{clearAll:function(){this.leaderInfo=[{name:"",id:""}],this.reason={text:""},this.dateTime={date:"",AMPM:""},this.AMRemain=8,this.PMRemain=8,this.localUpdateDateInfo()},addLeader:function(){this.leaderInfo.push({name:"",id:""}),this.localUpdateDateInfo(),"上午"===this.dateTime.AMPM&&this.AMRemain<this.leaderInfo.length&&(this.$message.error("该时段无法预约"+this.leaderInfo.length+"台机器, 请减少数量或重新选择时段"),this.dateTime.AMPM),"下午"===this.dateTime.AMPM&&this.PMRemain<this.leaderInfo.length&&(this.$message.error("该时段无法预约"+this.leaderInfo.length+"台机器, 请减少数量或重新选择时段"),this.dateTime.AMPM)},removeLeader:function(e){this.leaderInfo.splice(e,1),this.localUpdateDateInfo()},submit:function(){for(var e=this,t=!0,r=0;r<this.leaderInfo.length;++r)this.$refs.leaderForm[r].validate(function(e){t=t&&e});if(this.$refs.reasonForm.validate(function(e){t=t&&e}),this.$refs.dateTimeForm.validate(function(e){t=t&&e}),t){var a="";"上午"===this.dateTime.AMPM?a="AM":"下午"===this.dateTime.AMPM&&(a="PM"),console.log(this.dateTime.date);var n={operators:this.leaderInfo,date:this.dateTime.date,time:a,note:this.reason.text};this.$axios.post("/reserve/submit",n).then(function(t){e.$router.push("/success")}).catch(function(t){"Beyond max reserve limit"===t.response.data?e.$confirm("您的可用预约数不足，请减少表单中的预约人数或退出","预约失败",{confirmButtonText:"修改表单",cancelButtonText:"退出预约",type:"error"}).then(function(){}).catch(function(){e.$router.push({path:"/single_reserve",query:{no_warning:!0}})}):e.$message.error("预约失败，请检查表单后重试")})}},determineDateValid:function(e){for(var t=0;t<this.dateUnvalid.length;++t){var r=this.dateTranslate(new Date(e));if(this.dateUnvalid[t]===r)return!0}return!1},updateDateInfo:function(){var e=this;this.dateUnvalid=[],this.dateInfo=[],this.dateTime.date="";var t=this.dateTranslate(new Date),r=this,a=new URLSearchParams;a.append("start",t),a.append("length",90),this.$axios.post("/reserve/queryused",a).then(function(t){t.data.forEach(function(e){var t={date:e.date,AM:parseInt(e.AM),PM:parseInt(e.PM)};r.dateInfo.push(t),(t.AM+t.PM===0||t.AM<r.leaderInfo.length&&t.PM<r.leaderInfo.length)&&r.dateUnvalid.push(t.date)}),console.log(e.dateUnvalid)}).catch(function(t){e.$message.error("查询失败，请重试")}),this.dateOptions=M()({},this.dateOptions,{disabledDate:function(e){var t=e.getDay(),a=e.getTime();return 0===t||6===t||r.determineDateValid(e)||a<=Date.now()||a>=Date.now()+7776e6}})},localUpdateDateInfo:function(){var e=this;this.dateUnvalid=[],this.dateInfo.forEach(function(t){(t.AM+t.PM===0||t.AM<e.leaderInfo.length&&t.PM<e.leaderInfo.length)&&e.dateUnvalid.push(t.date)}),this.dateTime.date&&this.determineDateValid(this.dateTime.date)&&(this.dateTime.date="",this.$message.error("该日期打印机数量不足，请重新选择")),this.dateOptions=M()({},this.dateOptions,{disabledDate:function(t){var r=t.getDay(),a=t.getTime();return 0===r||6===r||e.determineDateValid(t)||a<=Date.now()||a>=Date.now()+7776e6}})},dateChanged:function(e){this.determineDateValid(e)&&(this.dateTime.date="",this.$message.error("该日期已经被选取，请重新选择"));var t=this;this.dateOptions=M()({},this.dateOptions,{disabledDate:function(e){var r=e.getDay(),a=e.getTime();return 0===r||6===r||t.determineDateValid(e)||a<=Date.now()||a>=Date.now()+7776e6}});var r=this.dateInfo.filter(function(t){return t.date===e})[0];this.AMRemain=parseInt(r.AM),this.PMRemain=parseInt(r.PM),console.log(r)},dateTranslate:function(e){var t=e.getFullYear().toString(),r=e.getMonth()+1,a=e.getDate(),n=r.toString();r<10&&(n="0"+n);var s=a.toString();return a<10&&(s="0"+s),t+"-"+n+"-"+s}}},D={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-card",{staticClass:"reserve-form"},[r("div",{staticClass:"sel-sub-title",attrs:{align:"left"}},[e._v("使用者信息")]),e._v(" "),e._l(e.leaderInfo,function(t,a){return r("div",{key:a},[r("el-row",[r("el-form",{ref:"leaderForm",refInFor:!0,attrs:{model:t,rules:e.leaderRules,"label-position":"right","label-width":"60px"}},[r("el-row",[r("el-col",{attrs:{span:.5}},[r("div",{staticStyle:{"font-weight":"500","font-size":"14px","line-height":"42px"},attrs:{align:"left"}},[e._v("("+e._s(a+1)+")")])]),e._v(" "),r("el-col",{attrs:{span:10.5}},[r("el-form-item",{attrs:{prop:"name",label:"姓名"}},[r("el-input",{attrs:{type:"text",placeholder:"请输入真实姓名","auto-complete":"off",size:"small"},model:{value:t.name,callback:function(r){e.$set(t,"name",r)},expression:"item.name"}}),e._v(" "),r("div",{staticClass:"form-tip",attrs:{align:"left"}},[e._v("输入使用人的姓名")])],1)],1),e._v(" "),r("el-col",{attrs:{span:11}},[r("el-form-item",{attrs:{prop:"id",label:"ID"}},[r("el-input",{attrs:{type:"text",placeholder:"请输入学号/工作证号","auto-complete":"off",size:"small"},model:{value:t.id,callback:function(r){e.$set(t,"id",r)},expression:"item.id"}}),e._v(" "),r("div",{staticClass:"form-tip",attrs:{align:"left"}},[e._v("输入使用人的学号或工作证件号码")])],1)],1),e._v(" "),r("el-col",{attrs:{span:2}},[r("div",{attrs:{align:"right"}},[e.leaderInfo.length>1?r("el-button",{staticStyle:{"margin-top":"5px",color:"red"},attrs:{type:"text",size:"small"},on:{click:function(t){return e.removeLeader(a)}}},[e._v("删除")]):e._e()],1)])],1)],1)],1)],1)}),e._v(" "),r("el-button",{attrs:{type:"text",disabled:e.leaderInfo.length>=e.$store.state.maxRsv},on:{click:e.addLeader}},[e._v("+添加使用者(对应一台打印机)")]),e._v(" "),r("div",{staticClass:"sel-sub-title",attrs:{align:"left"}},[e._v("预约理由")]),e._v(" "),r("el-form",{ref:"reasonForm",attrs:{model:e.reason,rules:e.reasonRule}},[r("el-form-item",{attrs:{prop:"text"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入本次预约的事由（如打印什么模型等）","auto-complete":"off",size:"small",resize:"none",autosize:{minRows:1}},model:{value:e.reason.text,callback:function(t){e.$set(e.reason,"text",t)},expression:"reason.text"}})],1)],1),e._v(" "),r("div",{staticClass:"sel-sub-title",staticStyle:{"margin-top":"20px"},attrs:{align:"left"}},[e._v("选择时间")]),e._v(" "),r("el-form",{ref:"dateTimeForm",attrs:{model:e.dateTime,rules:e.dateTimeRules,"label-position":"right","label-width":"80px"}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:"预约日期",prop:"date"}},[r("el-col",{attrs:{span:12}},[r("el-date-picker",{staticClass:"long-picker",attrs:{placeholder:"选择预约日期","picker-options":e.dateOptions,clearable:!1,size:"small",align:"left","value-format":"yyyy-MM-dd"},on:{change:e.dateChanged},model:{value:e.dateTime.date,callback:function(t){e.$set(e.dateTime,"date",t)},expression:"dateTime.date"}}),e._v(" "),r("div",{staticClass:"form-tip",attrs:{align:"left"}},[e._v("注意：只开放90天内的预约")])],1),e._v(" "),r("el-col",{attrs:{span:4}},[r("el-button",{staticClass:"long-picker",attrs:{type:"primary",size:"small",plain:!0},on:{click:e.updateDateInfo}},[e._v("刷新可选日期")])],1)],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:18}},[r("el-form-item",{attrs:{label:"预约时段",prop:"AMPM"}},[r("div",{attrs:{align:"left"}},[r("el-radio-group",{attrs:{size:"small",align:"left"},model:{value:e.dateTime.AMPM,callback:function(t){e.$set(e.dateTime,"AMPM",t)},expression:"dateTime.AMPM"}},[r("el-radio-button",{attrs:{label:"上午",disabled:e.leaderInfo.length>e.AMRemain}}),e._v(" "),r("el-radio-button",{attrs:{label:"下午",disabled:e.leaderInfo.length>e.PMRemain}})],1)],1),e._v(" "),r("div",{staticClass:"form-tip-large",attrs:{align:"left"}},[e._v("选择上午(08:00-12:00)或下午(13:00-17:00)")])])],1)],1)],1),e._v(" "),r("el-row",{staticStyle:{"margin-top":"20px"}},[r("el-col",{attrs:{span:12}},[r("el-button",{staticStyle:{width:"80%"},attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")])],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-button",{staticStyle:{width:"80%"},on:{click:e.clearAll}},[e._v("清空")])],1)],1)],2)],1)},staticRenderFns:[]};var F=r("C7Lr")(E,D,!1,function(e){r("lwr5")},"data-v-1ca5521a",null).exports,A={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-card",[t("div",{staticClass:"success-wow"},[t("i",{staticClass:"el-icon-success"}),this._v("\n      预约成功！\n    ")]),this._v(" "),t("div",{staticClass:"success-info"},[this._v("\n      可以在"),t("el-link",{staticClass:"success-info",on:{click:this.goRecord}},[this._v('"预约记录"')]),this._v("界面查看\n    ")],1)])],1)},staticRenderFns:[]};var L=r("C7Lr")({name:"ReserveSuccess",methods:{goRecord:function(){this.$router.push("/reservation_record")}}},A,!1,function(e){r("RM+n")},"data-v-136657ae",null).exports,q={name:"SpecialReserveForm",data:function(){return{leaderInfo:[{name:"",id:""}],reason:{text:""},reasonRule:{text:[{required:!0,message:"请输入预约事由",trigger:"blur"}]},leaderRules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],id:[{required:!0,message:"请输入证件号",trigger:"blur"},{validator:function(e,t,r){t?(/^20[0-9]{8}$/.test(t)||r(new Error("证件号格式错误")),r()):r(new Error("请输入证件号"))},trigger:"blur"}]},dateTimeRules:{time:[{required:!0,message:"请选择日期",trigger:"blur"}],duration:[{required:!0,message:"请选择时长",trigger:"blur"},{validator:function(e,t,r){t?((t<=0||t>6)&&r(new Error("时长应在0-6小时内")),r()):r(new Error("请选择时长"))},trigger:"blur"}]},dateTime:{time:"",duration:""},dateOptions:{disabledDate:function(e){var t=e.getTime();return t<=Date.now()||t>=Date.now()+7776e6}}}},methods:{clearAll:function(){this.dateSelected="",this.leaderInfo=[{name:"",id:""}],this.reason={text:""},this.dateTime={time:"",duration:""}},addLeader:function(){this.leaderInfo.push({name:"",id:""})},removeLeader:function(e){this.leaderInfo.splice(e,1)},submit:function(){for(var e=this,t=!0,r=0;r<this.leaderInfo.length;++r)this.$refs.leaderForm[r].validate(function(e){t=t&&e});this.$refs.reasonForm.validate(function(e){t=t&&e}),this.$refs.dateTimeForm.validate(function(e){t=t&&e});var a=this.dateTime.time.split(" "),n={operators:this.leaderInfo,date:a[0],time:a[1],note:"预计使用时长: "+this.dateTime.duration+"小时 | 预约事由: "+this.reason.text};console.log(n),this.$axios.post("/reserve/specialsubmit",n).then(function(t){e.$router.push("/pending")}).catch(function(t){console.log(t),e.$message.error("提交失败，请检查表单后重试")})},determineDateValid:function(e){for(var t=0;t<this.dateUnvalid.length;++t)if(this.dateUnvalid[t].getTime()===e.getTime())return console.log(!0),!0;return!1}}},z={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-card",{staticClass:"reserve-form"},[r("div",{staticClass:"sel-sub-title",attrs:{align:"left"}},[e._v("使用者信息")]),e._v(" "),e._l(e.leaderInfo,function(t,a){return r("div",{key:a},[r("el-row",[r("el-form",{ref:"leaderForm",refInFor:!0,attrs:{model:t,rules:e.leaderRules,"label-position":"right","label-width":"60px"}},[r("el-row",[r("el-col",{attrs:{span:.5}},[r("div",{staticStyle:{"font-weight":"500","font-size":"14px","line-height":"42px"},attrs:{align:"left"}},[e._v("("+e._s(a+1)+")")])]),e._v(" "),r("el-col",{attrs:{span:10.5}},[r("el-form-item",{attrs:{prop:"name",label:"姓名"}},[r("el-input",{attrs:{type:"text",placeholder:"请输入真实姓名","auto-complete":"off",size:"small"},model:{value:t.name,callback:function(r){e.$set(t,"name",r)},expression:"item.name"}}),e._v(" "),r("div",{staticClass:"form-tip",attrs:{align:"left"}},[e._v("输入使用人的姓名")])],1)],1),e._v(" "),r("el-col",{attrs:{span:11}},[r("el-form-item",{attrs:{prop:"id",label:"ID"}},[r("el-input",{attrs:{type:"text",placeholder:"请输入学号/工作证号","auto-complete":"off",size:"small"},model:{value:t.id,callback:function(r){e.$set(t,"id",r)},expression:"item.id"}}),e._v(" "),r("div",{staticClass:"form-tip",attrs:{align:"left"}},[e._v("输入使用人的学号或工作证件号码")])],1)],1),e._v(" "),r("el-col",{attrs:{span:2}},[r("div",{attrs:{align:"right"}},[e.leaderInfo.length>1?r("el-button",{staticStyle:{"margin-top":"5px",color:"red"},attrs:{type:"text",size:"small"},on:{click:function(t){return e.removeLeader(a)}}},[e._v("删除")]):e._e()],1)])],1)],1)],1)],1)}),e._v(" "),r("el-button",{attrs:{type:"text",disabled:e.leaderInfo.length>=e.$store.state.maxRsv},on:{click:e.addLeader}},[e._v("+添加使用者(对应一台打印机)")]),e._v(" "),r("div",{staticClass:"sel-sub-title",attrs:{align:"left"}},[e._v("预约理由")]),e._v(" "),r("el-form",{ref:"reasonForm",attrs:{model:e.reason,rules:e.reasonRule}},[r("el-form-item",{attrs:{prop:"text"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入本次预约的事由（如打印什么模型等）","auto-complete":"off",size:"small",resize:"none",autosize:{minRows:1}},model:{value:e.reason.text,callback:function(t){e.$set(e.reason,"text",t)},expression:"reason.text"}}),e._v(" "),r("div",{staticClass:"form-tip",staticStyle:{color:"purple"},attrs:{align:"left"}},[e._v("重要: 请认真填写预约该时段的特殊原因!")])],1)],1),e._v(" "),r("div",{staticClass:"sel-sub-title",staticStyle:{"margin-top":"20px"},attrs:{align:"left"}},[e._v("选择时间")]),e._v(" "),r("el-form",{ref:"dateTimeForm",attrs:{model:e.dateTime,rules:e.dateTimeRules,"label-position":"right","label-width":"100px"}},[r("el-row",[r("el-col",{attrs:{span:13}},[r("el-form-item",{attrs:{label:"预约时间",prop:"time"}},[r("el-date-picker",{staticClass:"long-picker",attrs:{type:"datetime",placeholder:"选择预约日期","picker-options":e.dateOptions,clearable:!1,size:"small",align:"left","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.dateTime.time,callback:function(t){e.$set(e.dateTime,"time",t)},expression:"dateTime.time"}}),e._v(" "),r("div",{staticClass:"form-tip",attrs:{align:"left"}},[e._v("注意：只开放90天内的预约")])],1)],1),e._v(" "),r("el-col",{attrs:{span:9}},[r("el-form-item",{attrs:{label:"使用时长",prop:"duration"}},[r("el-input",{attrs:{type:"number",placeholder:"请选择使用时长",size:"small",min:0,max:6},model:{value:e.dateTime.duration,callback:function(t){e.$set(e.dateTime,"duration",t)},expression:"dateTime.duration"}}),e._v(" "),r("div",{staticClass:"form-tip",attrs:{align:"left"}},[e._v("需要使用多少小时")])],1)],1)],1)],1),e._v(" "),r("el-row",{staticStyle:{"margin-top":"20px"}},[r("el-col",{attrs:{span:12}},[r("el-button",{staticStyle:{width:"80%"},attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")])],1),e._v(" "),r("el-col",{attrs:{span:12}},[r("el-button",{staticStyle:{width:"80%"},on:{click:e.clearAll}},[e._v("清空")])],1)],1)],2)],1)},staticRenderFns:[]};var U=r("C7Lr")(q,z,!1,function(e){r("XxTw")},"data-v-5735b8f0",null).exports,V={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-card",[t("div",{staticClass:"success-wow"},[t("i",{staticClass:"el-icon-success"}),this._v("\n      申请提交成功！\n    ")]),this._v(" "),t("div",{staticClass:"success-info"},[this._v("\n      可以在"),t("el-link",{staticClass:"success-info",on:{click:this.goRecord}},[this._v('"预约记录"')]),this._v("界面查看\n    ")],1)])],1)},staticRenderFns:[]};var B=r("C7Lr")({name:"ReservePending",methods:{goRecord:function(){this.$router.push("/reservation_record")}}},V,!1,function(e){r("gnl3")},"data-v-769e0f27",null).exports,N={name:"AdminSignIn",data:function(){return{search:{id:""},records:[],rules:{id:[{required:!0,validator:function(e,t,r){t?(/^20[0-9]{8}$/.test(t)||r(new Error("格式错误")),r()):r(new Error("请填写学号/工作证号"))},trigger:"blur"}]}}},methods:{queryID:function(){var e=this;this.$refs.signinform.validate(function(t){if(t){var r=e;console.log(r.search.id),e.$axios.get("/reserve/querysignin",{params:{id:r.search.id}}).then(function(t){r.records=t.data,0===r.records.length&&e.$message.error("该学号当前没有预约！")}).catch(function(t){r.records=[],e.$message.error("查询失败，请重试")})}})},signIn:function(e,t){var r=this;this.$prompt("请输入签到记录的用户ID以完成签到确认","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/[0-9]+/,inputErrorMessage:"输入格式错误",inputValidator:function(e){if(e!==t)return"输入不一致"}}).then(function(a){if(a.value===t){var n=new URLSearchParams;n.append("id",e),r.$axios.post("/reserve/signin",n).then(function(e){var t=e.data.machine_id;r.$alert("签到成功，请使用"+t+"号打印机","提示",{confirmButtonText:"确定"}),r.records=[]}).catch(function(e){console.log(e),r.$message.error("签到失败，请刷新页面并重试")})}}).catch(function(){})}}},O={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-card",[r("el-form",{ref:"signinform",attrs:{model:e.search,rules:e.rules,"label-position":"right","label-width":"120px"}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{prop:"id",label:"学号/工作证号"}},[r("el-col",{attrs:{span:16}},[r("el-input",{attrs:{placeholder:"填写签到人证件号"},model:{value:e.search.id,callback:function(t){e.$set(e.search,"id",t)},expression:"search.id"}})],1),e._v(" "),r("el-col",{attrs:{span:4}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.queryID}},[e._v("查询")])],1)],1)],1)],1)],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:24}},[r("el-table",{attrs:{data:e.records}},[r("el-table-column",{attrs:{prop:"id",label:"编号","min-width":"60",align:"center"}}),e._v(" "),r("el-table-column",{attrs:{label:"预约时间","min-width":"160",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.submit_time))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"使用时间","min-width":"160",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["AM"===t.row.time?r("div",[e._v("上午")]):e._e(),e._v(" "),"PM"===t.row.time?r("div",[e._v("下午")]):e._e(),e._v(" "),"OT"===t.row.time?r("div",[e._v("其他")]):e._e()]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"使用人",align:"center"}},[r("el-table-column",{attrs:{label:"姓名","min-width":"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.operator.name))])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"ID","min-width":"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.operator.id))])]}}])})],1),e._v(" "),r("el-table-column",{attrs:{label:"备注","min-width":"70",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-popover",{attrs:{placement:"right",trigger:"click",width:"120"}},[r("div",[e._v(e._s(t.row.note))]),e._v(" "),r("el-button",{attrs:{slot:"reference",size:"small",type:"primary",plain:!0,disabled:!t.row.note},slot:"reference"},[e._v("查看")])],1)]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"small",type:"primary",plain:!0},on:{click:function(r){return e.signIn(t.row.id,t.row.operator.id)}}},[e._v("签到")])]}}])})],1)],1)],1)],1)],1)},staticRenderFns:[]};var j=r("C7Lr")(N,O,!1,function(e){r("TMXd")},"data-v-580a961c",null).exports;s.default.use(h.a);var H=new h.a({routes:[{path:"/",name:"LogIn",component:w,meta:{hasNavbar:!1,hasInfo:!1,title:"登录",authType:"all"}},{path:"/register",name:"Register",component:P,meta:{hasNavbar:!1,hasInfo:!1,title:"注册",authType:"all"}},{path:"/single_reserve",name:"SingleReserve",component:I,meta:{hasNavbar:!0,hasInfo:!0,title:"个人预约",authType:"user"}},{path:"/reservation_record",name:"ReservationRecord",component:S,meta:{hasNavbar:!0,hasInfo:!0,title:"预约记录",authType:"user"}},{path:"/single_reserve_form",name:"SingleReserveForm",component:F,meta:{hasNavbar:!0,hasInfo:!0,title:"填写普通预约表格",authType:"user"}},{path:"/special_reserve_form",name:"SpecialReserveForm",component:U,meta:{hasNavbar:!0,hasInfo:!0,title:"特殊时段预约申请",authType:"user"}},{path:"/success",name:"ReserveSuccess",component:L,meta:{hasInfo:!0,hasNavbar:!0,title:"提示",authType:"user"}},{path:"/pending",name:"ReservePending",component:B,meta:{hasInfo:!0,hasNavbar:!0,title:"提示",authType:"user"}},{path:"/admin_signin",name:"AdminSignIn",component:j,meta:{hasInfo:!1,hasNavbar:!1,title:"签到",authType:"admin"}}]}),Z=r("jsbU"),X=r.n(Z),J=(r("+/MR"),r("Muz9")),Y=r.n(J),G=r("2bvH"),K=r("jTNT");s.default.use(G.a);var Q=new G.a.Store({state:{routeList:[],username:"",isAdmin:!1,maxRsv:0},mutations:{setRouteList:function(e,t){e.routeList=t},login:function(e,t){e.username=t.username,e.isAdmin=t.isAdmin,e.maxRsv=t.maxRsv},logout:function(e){e.username="",e.routeList=[],e.isAdmin=!1,e.maxRsv=0}},plugins:[Object(K.a)()]});s.default.config.productionTip=!1,s.default.use(X.a),s.default.prototype.$axios=Y.a,Y.a.defaults.baseURL="/api",Y.a.interceptors.response.use(function(e){return e},function(e){return console.log(e),console.log(e.response),403===e.response.status&&(console.log("login err"),X.a.Message.error("登陆失效，请重新登录"),H.replace("/"),Q.commit("logout")),n.a.reject(e)}),H.beforeEach(function(e,t,r){if(t.name){if("SingleReserveForm"===e.name&&"SingleReserve"!==t.name){r("/single_reserve");var a=[];return a.push({path:"/single_reserve",query:"",title:"个人预约"}),void Q.commit("setRouteList",a)}if("SpecialReserveForm"===e.name&&"SingleReserve"!==t.name){r("/single_reserve");var n=[];return n.push({path:"/single_reserve",query:"",title:"个人预约"}),void Q.commit("setRouteList",n)}}console.log(e.query),"SingleReserveForm"!==t.name&&"SpecialReserveForm"!==t.name||"LogIn"===e.name||"ReserveSuccess"===e.name||"ReservePending"===e.name||"no_waning"in e.query&&e.query.no_warning?"all"===e.meta.authType?r():"user"===e.meta.authType?Q.state.isAdmin?(X.a.Message.error("权限错误，请重新登录"),Q.commit("logout"),r("/")):""===Q.state.username?(console.log(Q.state),X.a.Message.error("登录失效，请重新登录"),Q.commit("logout"),r("/")):r():"admin"===e.meta.authType?Q.state.isAdmin?""===Q.state.username?(X.a.Message.error("登录失效，请重新登录"),Q.commit("logout"),r("/")):r():(X.a.Message.error("权限错误，请重新登录"),Q.commit("logout"),r("/")):r():X.a.MessageBox.confirm("这样会删除所有的表单数据","确定离开界面?",{type:"warning"}).then(function(){r()}).catch(function(){})}),new s.default({el:"#app",router:H,store:Q,components:{App:v},template:"<App/>"})},"RM+n":function(e,t){},Ru3H:function(e,t){},TMXd:function(e,t){},XxTw:function(e,t){},gnl3:function(e,t){},jCJR:function(e,t){},jVDp:function(e,t){},kce6:function(e,t){},kfZH:function(e,t){},lwr5:function(e,t){},vMds:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.78c210d1fe3899c17d51.js.map